### 需求呈现

> 类似聊天消息，有多种类型：文本，图片，语音，视频
>
> 每一种类型展示只是容器内部各有不同，但是外部如好友，自己头像，消息未发送成功气泡。容器气泡都是通用的。所以一般的写法就是父cell用来配置这些通用的控件，子视图用来展示不同的内容

#### cell的继承方式有两种

* 通过纯代码：这种比较简单不做考虑，复用，拓展有些不便
* 通过xib：拓展方便，按块操作，容易复用

> 以下讲解通过xib操作的方式

#### cell.xib继承策略

##### 设想开始：

1. 创建一个基容器 MessageBaseCell  (包含xib,.swift)

2. 创建继承基础cell的文本MessageTextCell (.swift) 

> 由于第2步创建不了.xib文件，所以无法使用后续的nib加载方式。 问题所在 【OC 语言部分貌似可以直接创建，需要操作尝试下】



##### 新思路：

* BaseCell 与 TextCell都使用xib，内部容器不是cell类型，而是UIView类型
* 加载使用类方式加载，但是在实现内部将xib中的文件塞入到cell中

工程源文件展示如下：

![Base_xib展示](https://linfengwenyou.github.io/images/2018-11-20 Base_xib.png)

```
// BaseCell.swift
 // 根容器的使用
    override init(style: UITableViewCellStyle, reuseIdentifier: String?) {
        super.init(style: style, reuseIdentifier: reuseIdentifier)
        self.loadViewFromXib()
    }
    
    required init?(coder aDecoder: NSCoder) {
        super.init(coder: aDecoder)
    }
    
    // 直接代码加载空容器，然后将baseCell.xib中的视图实例化，添加到容器中。含有控件：头像，气泡等
    func loadViewFromXib() {
        let nib = UINib.init(nibName: stringOfClass(RAYMessageBaseCell.self), bundle: nil)
        let contentView = nib.instantiate(withOwner: self, options: nil).first as! UIView
        contentView.backgroundColor = UIColor.clear
        self.contentView.addSubview(contentView)
        
        contentView.translatesAutoresizingMaskIntoConstraints = false
        contentView.snp.makeConstraints { (make) in
            make.edges.equalTo(self.contentView)
        }
        
        self.backgroundColor = UIColor.clear
        
        self.configUI()  // 调整布局样式等
    }
```

![Text_xib展示](https://linfengwenyou.github.io/images/2018-11-20 Base_swift.png)



---



![Text_xib展示](https://linfengwenyou.github.io/images/2018-11-20 Text_xib.png)

```
// TextCell.swift

// 只需要重写这个方法，将需要的容器，添加到父类的气泡容器中
  override func loadViewFromXib() {
        super.loadViewFromXib()
        
        let nib = UINib.init(nibName: stringOfClass(RAYMessageTextCell.self), bundle: nil)
        let contentView = nib.instantiate(withOwner: self, options: nil).first as! UIView
        contentView.backgroundColor = UIColor.clear
        self.chatContainerView.addSubview(contentView)
        contentView.translatesAutoresizingMaskIntoConstraints = false
        contentView.snp.makeConstraints { (make) in
            make.edges.equalTo(self.chatContainerView)
        }
        
    }
```



---

```
// 调用方式,使用类名不是xib进行缓存
self.chatView.register(RAYMessageTextCell.self , forCellReuseIdentifier: stringOfClass(RAYMessageTextCell.self))
self.chatView.register(RAYMessageImageCell.self, forCellReuseIdentifier: stringOfClass(RAYMessageImageCell.self))
```



```
使用cell方式
func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let model = self.messageModels[indexPath.row]
        let cell: RAYMessageBaseCell!
        switch model.chatType {
        case .text:
            cell = tableView.dequeueReusableCell(withIdentifier: stringOfClass(RAYMessageTextCell.self)) as! RAYMessageTextCell
        case .image:
            cell = tableView.dequeueReusableCell(withIdentifier: stringOfClass(RAYMessageImageCell.self)) as! RAYMessageImageCell
        default:
            cell = RAYMessageBaseCell()
        }
		cell.model = self.messageModels[indexPath.row]
		return cell
	}
```



