
####  列表考虑点

1. 网络异常错误信息及提示信息
2. 正常情况下数据展示，上拉加载，情况，下拉刷新情况及条件判断。
3. 网络正常情况下，数据返回0的处理，背景展示，是否展示下拉，上拉操作
4. 网络请求时机：MJ刷新与ViewWillAppear放在一起会出现一些问题，测试时需要注意
5. 列表优化


#### 列表优化

首先分析下列表卡顿的原理 <a href="https://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/" target="_blank">卡顿原理</a>

引入几句便与理解

> 显示器通常以固定频率进行刷新，这个刷新率就是 VSync 信号产生的频率
>
> （卡顿产生的原因）
>
> 在 VSync 信号到来后，系统图形服务会通过 CADisplayLink 等机制通知 App，App 主线程开始在 CPU 中计算显示内容，比如__视图的创建、布局计算、图片解码、文本绘制等__。随后 CPU 会将计算好的内容提交到 GPU 去，由 GPU 进行__变换、合成、渲染__。随后 GPU 会把渲染结果提交到帧缓冲区去，等待下一次 VSync 信号到来时显示到屏幕上。由于垂直同步的机制，如果在一个 VSync 时间内，CPU 或者 GPU 没有完成内容提交，则那一帧就会被丢弃，等待下一次机会再显示，而这时显示屏会保留之前的内容不变。这就是界面卡顿的原因。

由此可以看到，如果屏幕刷新频率为60Hz,，CPU+GPU处理一帧所耗的时常如果超过 1/60s就会出现卡顿，那解决的方式也就出现了。 

首先CPU处理了视图创建、布局计算、图片解码、文本绘制等。GPU进行变换、合成、渲染操作。

那么从列表数据的请求到展示过程便有几种优化策略。

* 网络请求，进行数据缓存，
* 数据转模型时，如果有涉及到cell展示拼接的内容，比如状态+金额等。最好提供模型字段，避免cell创建时重复计算
* 对于复杂的cell结构，尺寸不一的情况，在知晓模型时便可以计算出布局信息，那便可以对布局信息进行缓存，防止重复计算，通过fdtemplateLayoutCell来缓存cell高度信息
* cell创建，尽量重用(reuseIdentifier)，cell内部控件尽可能的少，对于背景，边角耗费GPU时间的尽量使用图片代替
* 图片的加载一般是在即将展示某些cell时再加载，移除展示时暂时挂起操作。等再度展示时重新执行下载
* 图片如果比较多，可以在后台将图片在CGBitmap中绘制【解码过程】，然后直接输出图片给UIImageView.layer.contents。


####  label字体尺寸

##### 	字体尺寸一般使用设计图尺寸/2处理  

【设计图一般为6s分辨率  `750*1334`】

##### 	如果是内容可能会超出尺寸，可以设置内容最小偏移量
`Autoshrink Minimum Font Scale` 一般设置0.5即可，相当于使用如下代码：
   ```
   label.adjustsFontSizeToFitWidth = YES;
   label.minimumScaleFactor = 0.5;
   ```
##### 	字体颜色，如果是与全局配置就使用宏，不然就直接设置
 > a. 何时使用label字体缩小功能？

当展示数据比较重要长度有比较大时，比如说2千万吨，这样肯定要求所有的内容得到展示，这就要求默认的宽度要达到这个标准字体字符串的长度，在此之后就要设置放缩形式，然后需要考虑不能字体小到一个极限，此时就要设置字体最小的放缩比例，一般设置0.5吧。

 > b. 如果展示内容有要求的话有两个考虑点：

* 设置一个合适的最大尺寸
* 设置放缩的最小比例

##### 达到的目标：
1. 正常展示一定范围内的值 
2. 超出此范围的值放缩处理，如果放缩的最小还展示不了就使用省略号处理。

#### 带输入的弹出框
##### 设计最好直接使用控制器来做，然后设置展示动画效果。
原因是：`IQKeyboardManager`会根据当前唤起键盘的view所在的父控件来处理【如果找到`scrollView`便是，否则是`self.view`】，如果是`self.view`，就会使整个控制器向上偏移，这样就会导致导航栏上移，每次弹出键盘，导航栏上移看起来就很古怪了就很。。。。使用控制器做弹出框，弹出键盘时就会控制器上移也不会影响其他展示。

#### 针对模块化的操作
##### a. 有多个控制器
【如：修找回支付密码，验证密码，手机号，验证码，设置新密码，几个页面】modal出来比较容易管理

在每一个页面，这种操作都是可以进入的，那就不要设计成push操作，不然就需要考虑，成功或失败后需要`pop`到那个页面。 使用`modal`方式，成功或失败后只需要`dismiss`即可，如果细致点要考虑谁来`dismiss`啦。
还要考虑到中间放弃操作的行为一般为进入的第一个控制器，这样就可以实现功能内部的逻辑操作，而不用考虑模块与其他模块的耦合关系
<a href="https://onevcat.com/2013/10/vc-transition-in-ios7/" target="_blank">`dismiss`问题了解</a>

##### b. 只有一个控制器【如：修改登录密码】
如果只有一个控制器就不用考虑了， 成功后直接pop出就好了

#### 表单提交防重复点击
不要使用固定的延迟时间，需要根据网络处理情况来控制按钮的状态。

操作流程可以为： 

```
点击按钮 -> 设置按钮状态为不可操作 ——(请求中)—> 网络请求结束后 —> 调整按钮状态为可操作
```

__实现：__

通过自定义按钮UCSButton，为其添加一个loading状态，在网络进行处理时调整其状态。

#### UI布局策略
<a href="http://ddc.dianrong.com/?p=597" target="_blank">三种布局方式各有千秋</a>

#### 布局热区点击事件
如果在某一区域上设置了热区，照一般的思路会直接在上面覆盖一个button，设置好约束然后再拖拽插座变量。
###### 弊端：
这样的话在调整控件布局时选中起来相当麻烦，而且限制了手动拖动调整布局的便利性。
###### 优化：
通过代码添加一个view，设置view的tap手势，这样就可以避免这些弊端，但是需要手写部分代码。后续调整布局起来确实方便了不少。

<a href="https://onevcat.com/2013/12/code-vs-xib-vs-storyboard/" target="_blank">布局的一些小技巧</a>



#### 列表数据加载更多是否需要进行数据去重
需要看后台怎样进行数据处理，如果是页数需要过滤，如果通过索引就要判断添加或移除数据会不会对数据的索引进行移动，此时就需要考虑是否需要过滤了。【需要清楚后台对列表的处理规则】

#### 判字符串问题
展示需要字段转化为整型数据的控件需要做下容错处理
1. 判断是否字段存在 
2. 字段转为整型符合接口要求才能处理。

比如，如果要求返回0，代表待收货状态，如果字段不存在，直接进行整型转换就是0，此时就会出现数据问题导致界面出错。需要做容错处理。。
当前处理方式：
```
// ordersRemain是个字符串，当为0时代表某一状态。。。
if (itemModel.ordersRemain.length > 0 && itemModel.ordersRemain.integerValue == 0) {
  /** 处理逻辑*/   // 有时候需要考虑trim下，移除空格字符信息,看时机数据转换时有进行移除空格
}
```

